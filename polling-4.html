<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VoteHub ‚Äî Polling Aggregator</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üó≥Ô∏è</text></svg>">
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=DM+Sans:ital,opsz,wght@0,9..40,300..800;1,9..40,300..800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    [data-theme="light"]{--bg:#f5f4f1;--card:#fff;--elevated:#fff;--inset:#eeedea;--glass:rgba(245,244,241,.82);--glass2:rgba(255,255,255,.92);--t1:#0d0d0d;--t2:#4a4a4a;--t3:#8a8a8a;--t4:#b0b0b0;--brd:rgba(0,0,0,.07);--brds:rgba(0,0,0,.12);--brdt:rgba(0,0,0,.03);--dem:#1d4ed8;--dems:rgba(29,78,216,.08);--demm:rgba(29,78,216,.18);--rep:#dc2626;--reps:rgba(220,38,38,.08);--repm:rgba(220,38,38,.18);--app:#059669;--apps:rgba(5,150,105,.08);--dis:#dc2626;--diss:rgba(220,38,38,.08);--acc:#1d4ed8;--dot:rgba(0,0,0,.025);--s1:0 1px 3px rgba(0,0,0,.04),0 6px 24px rgba(0,0,0,.04);--s2:0 4px 16px rgba(0,0,0,.06),0 1px 3px rgba(0,0,0,.04);--s3:0 8px 32px rgba(0,0,0,.08)}
    [data-theme="dark"]{--bg:#09090b;--card:#141416;--elevated:#1a1a1e;--inset:#0f0f12;--glass:rgba(9,9,11,.85);--glass2:rgba(20,20,22,.95);--t1:#ececec;--t2:#999;--t3:#5a5a5a;--t4:#3a3a3a;--brd:rgba(255,255,255,.06);--brds:rgba(255,255,255,.1);--brdt:rgba(255,255,255,.03);--dem:#60a5fa;--dems:rgba(96,165,250,.1);--demm:rgba(96,165,250,.2);--rep:#f87171;--reps:rgba(248,113,113,.1);--repm:rgba(248,113,113,.2);--app:#34d399;--apps:rgba(52,211,153,.1);--dis:#f87171;--diss:rgba(248,113,113,.1);--acc:#60a5fa;--dot:rgba(255,255,255,.015);--s1:0 1px 3px rgba(0,0,0,.3),0 6px 24px rgba(0,0,0,.2);--s2:0 4px 16px rgba(0,0,0,.4);--s3:0 8px 32px rgba(0,0,0,.5)}
    :root{--rs:10px;--rm:14px;--rl:20px;--rf:9999px;--fd:'Playfair Display',Georgia,serif;--fb:'DM Sans',-apple-system,sans-serif;--fm:'JetBrains Mono',monospace;--eo:cubic-bezier(.22,1,.36,1)}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:var(--fb);background:var(--bg);color:var(--t1);line-height:1.6;-webkit-font-smoothing:antialiased;min-height:100vh;overflow-x:hidden;transition:background .4s,color .4s}
    #bgCanvas{position:fixed;inset:0;z-index:0;pointer-events:none}

    /* HEADER */
    .hdr{position:sticky;top:0;z-index:200;background:var(--glass);backdrop-filter:blur(24px) saturate(180%);-webkit-backdrop-filter:blur(24px) saturate(180%);border-bottom:1px solid var(--brd);transition:box-shadow .3s}
    .hdr.scrolled{box-shadow:var(--s2)}
    .hdr-in{max-width:1360px;margin:0 auto;padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:64px;gap:1rem}
    .logo-g{display:flex;align-items:center;gap:.85rem}
    .logo-m{width:36px;height:36px;border-radius:var(--rs);background:linear-gradient(135deg,var(--dem),var(--rep));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.7rem;font-family:var(--fm);letter-spacing:.05em;flex-shrink:0;box-shadow:0 2px 12px rgba(29,78,216,.3);position:relative;overflow:hidden}
    .logo-m::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,rgba(255,255,255,.2))}
    .logo-t h1{font-family:var(--fd);font-size:1.35rem;font-weight:700;letter-spacing:-.02em;line-height:1}
    .logo-t .tag{font-size:.62rem;color:var(--t3);font-weight:500;letter-spacing:.14em;text-transform:uppercase;margin-top:2px}
    .hdr-act{display:flex;align-items:center;gap:.5rem}
    .theme-btn{width:36px;height:36px;border-radius:var(--rf);border:1px solid var(--brd);background:var(--card);color:var(--t2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.05rem;transition:all .2s}
    .theme-btn:hover{border-color:var(--acc);color:var(--acc);transform:rotate(20deg)}
    .ld{width:8px;height:8px;border-radius:50%;background:var(--acc);display:none;animation:pulse 1s ease infinite}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}
    .fpill{display:flex;align-items:center;gap:.5rem;cursor:pointer;user-select:none;padding:5px 14px 5px 8px;border-radius:var(--rf);border:1px solid var(--brd);background:var(--card);transition:all .2s;font-size:.78rem;font-weight:600;color:var(--t2)}
    .fpill:hover{border-color:var(--acc);color:var(--t1)}
    .fpill input{display:none}
    .pdot{width:8px;height:8px;border-radius:50%;background:var(--t3);transition:all .2s;flex-shrink:0}
    .fpill input:checked~.pdot{background:var(--app);box-shadow:0 0 8px rgba(5,150,105,.5)}

    /* MAIN */
    main{max-width:1360px;margin:0 auto;padding:1.75rem 2rem 3rem;display:flex;flex-direction:column;gap:1.25rem;position:relative;z-index:1}

    /* ALERTS */
    .alert{padding:.75rem 1.15rem;border-radius:var(--rm);font-size:.82rem;font-weight:500;display:none;animation:si .4s var(--eo);border:1px solid transparent}
    .alert.info{background:var(--dems);color:var(--dem);border-color:var(--demm)}
    .alert.error{background:var(--reps);color:var(--rep);border-color:var(--repm)}
    .alert.warn{background:rgba(245,158,11,.1);color:#b45309;border-color:rgba(245,158,11,.2)}
    .alert.success{background:var(--apps);color:var(--app);border-color:rgba(5,150,105,.2)}
    @keyframes si{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

    /* HERO */
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
    .hc{background:var(--card);border:1px solid var(--brd);border-radius:var(--rl);padding:1.75rem 2rem 1.5rem;box-shadow:var(--s1);position:relative;overflow:hidden;transition:transform .3s var(--eo),box-shadow .3s;cursor:default}
    .hc:hover{transform:translateY(-3px);box-shadow:var(--s3)}
    .hc::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
    .hc.ta::before{background:linear-gradient(90deg,var(--app),var(--dis))}
    .hc.tg::before{background:linear-gradient(90deg,var(--dem),var(--rep))}
    .hc::after{content:'';position:absolute;top:-60px;right:-60px;width:160px;height:160px;border-radius:50%;opacity:.12;filter:blur(40px);pointer-events:none;transition:opacity .3s}
    .hc.ta::after{background:var(--app)}
    .hc.tg::after{background:var(--dem)}
    .hc:hover::after{opacity:.22}
    .hl{font-size:.6rem;text-transform:uppercase;letter-spacing:.16em;color:var(--t3);font-weight:700;margin-bottom:1rem}
    .hr{display:flex;align-items:baseline;gap:.5rem;flex-wrap:wrap}
    .hn{font-family:var(--fm);font-size:3rem;font-weight:700;line-height:1;letter-spacing:-.04em}
    .hvs{font-size:1.4rem;color:var(--t4);font-weight:300;margin:0 .15rem}
    .hb{font-family:var(--fm);font-size:.85rem;font-weight:700;padding:4px 12px;border-radius:var(--rs);margin-left:auto;white-space:nowrap}
    .hm{margin-top:1rem;display:flex;align-items:center;gap:.75rem;font-size:.72rem;color:var(--t3)}
    .mb{display:inline-flex;align-items:center;gap:3px;font-weight:700;font-size:.68rem;padding:2px 8px;border-radius:var(--rf);font-family:var(--fm)}
    .mb.up{color:var(--app);background:var(--apps)}.mb.down{color:var(--rep);background:var(--reps)}.mb.flat{color:var(--t3);background:var(--inset)}
    .hsp{position:absolute;bottom:0;left:0;right:0;height:48px;opacity:.15;pointer-events:none}

    /* TIME SELECTOR */
    .ts{display:flex;gap:3px;background:var(--inset);padding:3px;border-radius:var(--rf);border:1px solid var(--brd);width:fit-content}
    .tb{font-family:var(--fm);font-size:.68rem;font-weight:600;padding:5px 14px;border-radius:var(--rf);border:none;background:transparent;color:var(--t3);cursor:pointer;transition:all .15s;letter-spacing:.02em}
    .tb:hover{color:var(--t1)}.tb.on{background:var(--card);color:var(--t1);box-shadow:0 1px 2px rgba(0,0,0,.04)}

    /* CARDS */
    .cd{background:var(--card);border:1px solid var(--brd);border-radius:var(--rl);padding:2rem;box-shadow:var(--s1);transition:box-shadow .3s,background .4s;position:relative}
    .cd:hover{box-shadow:var(--s2)}
    .ch{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1.5rem;gap:1rem;flex-wrap:wrap}
    .ct{font-family:var(--fd);font-size:1.5rem;font-weight:700;line-height:1.15;letter-spacing:-.01em}
    .cs{font-size:.74rem;color:var(--t3);font-weight:500;margin-top:.15rem}
    .ca{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}

    /* STATS */
    .sg{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:.75rem;margin-bottom:1.5rem}
    .sc{background:var(--inset);padding:1rem 1.15rem;border-radius:var(--rm);border:1px solid var(--brdt);display:flex;flex-direction:column;gap:.3rem;transition:border-color .15s}
    .sc:hover{border-color:var(--brds)}
    .sl{font-size:.58rem;color:var(--t3);text-transform:uppercase;letter-spacing:.12em;font-weight:700}
    .sv{font-family:var(--fm);font-size:1.5rem;font-weight:700;line-height:1.15;display:flex;align-items:baseline;gap:.5rem;letter-spacing:-.03em}
    .tt{font-size:.68rem;font-weight:700;padding:2px 7px;border-radius:var(--rf);display:inline-flex;align-items:center;font-family:var(--fm)}
    .tt.up{color:var(--app);background:var(--apps)}.tt.down{color:var(--rep);background:var(--reps)}.tt.flat{color:var(--t3);background:var(--inset);border:1px solid var(--brd)}

    /* CHARTS */
    .pw{width:100%;height:500px;position:relative;border-radius:var(--rm);overflow:hidden}
    .pw.dc{height:250px;margin-top:1rem;display:none}
    .cf{font-size:.7rem;color:var(--t4);margin-top:.75rem;font-style:italic}

    /* BUTTONS */
    .btn{appearance:none;border:1px solid var(--brd);background:var(--card);color:var(--t2);padding:6px 14px;border-radius:var(--rf);font-weight:600;font-size:.72rem;font-family:var(--fb);cursor:pointer;transition:all .15s;white-space:nowrap;display:inline-flex;align-items:center;gap:.35rem}
    .btn:hover{border-color:var(--acc);color:var(--acc);background:var(--inset)}
    .btn:active{transform:scale(.97)}

    /* CFG PANEL */
    .cp{margin:0 0 1.5rem;padding:1.15rem;border:1px solid var(--brd);border-radius:var(--rm);background:var(--inset);animation:si .3s var(--eo)}
    .cg{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;align-items:start}
    .ci{display:flex;flex-direction:column;gap:.35rem}
    .cl{font-size:.62rem;color:var(--t3);text-transform:uppercase;letter-spacing:.1em;font-weight:700}
    .cr{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .cr input[type="number"]{width:4.5rem;padding:.35rem .5rem;border-radius:var(--rs);border:1px solid var(--brd);background:var(--card);color:var(--t1);font-weight:600;font-family:var(--fm);font-size:.82rem}
    .cr input[type="range"]{flex:1;min-width:120px;accent-color:var(--acc)}
    label.cc{display:flex;gap:.5rem;align-items:center;cursor:pointer;user-select:none;font-weight:600;font-size:.82rem}
    label.cc input{accent-color:var(--acc);width:1rem;height:1rem;margin:0}
    .sm{font-size:.74rem;color:var(--t3)}

    /* FEED */
    .fg{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
    .fs h3{font-family:var(--fd);font-size:1.05rem;font-weight:700;margin-bottom:.85rem;display:flex;align-items:center;gap:.5rem}
    .fs h3 .dt{width:8px;height:8px;border-radius:50%;flex-shrink:0}
    .fl{display:flex;flex-direction:column;gap:.4rem;max-height:280px;overflow-y:auto;padding-right:.25rem}
    .fi{display:grid;grid-template-columns:1fr auto auto;gap:.75rem;align-items:center;padding:.65rem .85rem;border-radius:var(--rs);background:var(--inset);border:1px solid var(--brdt);font-size:.78rem;transition:border-color .15s}
    .fi:hover{border-color:var(--brds)}
    .fp{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .fd{font-family:var(--fm);font-size:.68rem;color:var(--t3)}
    .fv{display:flex;gap:.5rem;font-family:var(--fm);font-weight:700;font-size:.78rem}

    /* POLLSTER TABLE */
    .ptw{overflow-x:auto;margin-top:.75rem}
    .pt{width:100%;border-collapse:collapse;font-size:.78rem}
    .pt th{text-align:left;font-size:.6rem;text-transform:uppercase;letter-spacing:.1em;color:var(--t3);font-weight:700;padding:.5rem .75rem;border-bottom:2px solid var(--brds);white-space:nowrap}
    .pt td{padding:.55rem .75rem;border-bottom:1px solid var(--brdt);white-space:nowrap}
    .pt tr:hover td{background:var(--inset)}
    .pt .mn{font-family:var(--fm);font-weight:600;font-size:.76rem}
    .lb{display:inline-block;height:6px;border-radius:3px;min-width:4px;vertical-align:middle}
    .bc{font-family:var(--fm);font-size:.68rem;font-weight:700;background:var(--inset);border:1px solid var(--brd);padding:1px 8px;border-radius:var(--rf)}
    .mc{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:var(--rf);font-size:.62rem;font-weight:700;letter-spacing:.04em;text-transform:uppercase}
    .mc.on{background:var(--apps);color:var(--app)}.mc.off{background:var(--dems);color:var(--dem)}

    /* DEBUG */
    #debugCard{display:none}
    #debugOut{background:#0a0a0a;color:#4ade80;padding:1rem;border-radius:var(--rs);overflow-x:auto;font-family:var(--fm);font-size:.74rem}

    /* FOOTER */
    .ft{text-align:center;padding:2.5rem 2rem;color:var(--t3);font-size:.74rem;border-top:1px solid var(--brd);background:var(--card);position:relative;z-index:1;transition:background .4s}
    .ft .br{font-family:var(--fd);font-size:1rem;font-weight:700;color:var(--t2);margin-bottom:.4rem}

    /* ANIMATIONS */
    @keyframes fu{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .s1{animation:fu .55s var(--eo) .05s both}.s2{animation:fu .55s var(--eo) .12s both}.s3{animation:fu .55s var(--eo) .19s both}.s4{animation:fu .55s var(--eo) .26s both}.s5{animation:fu .55s var(--eo) .33s both}

    /* RESPONSIVE */
    @media(max-width:900px){.hero,.fg{grid-template-columns:1fr}.hdr-in{padding:0 1rem}main{padding:1.25rem 1rem}}
    @media(max-width:640px){.hn{font-size:2.2rem}.hc{padding:1.25rem 1.35rem 1rem}.cd{padding:1.25rem}.ct{font-size:1.25rem}.pw{height:340px}.sg{grid-template-columns:1fr 1fr}.logo-t .tag{display:none}.ts{overflow-x:auto}}
    ::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--t4);border-radius:99px}::-webkit-scrollbar-thumb:hover{background:var(--t3)}
  </style>
</head>
<body>
<canvas id="bgCanvas"></canvas>
<header class="hdr" id="siteHeader">
  <div class="hdr-in">
    <div class="logo-g">
      <div class="logo-m">VH</div>
      <div class="logo-t"><h1>VoteHub</h1><div class="tag">Polling Aggregation</div></div>
    </div>
    <div class="hdr-act">
      <div class="ld" id="loadingIndicator"></div>
      <label class="fpill" title="Quality filter"><input type="checkbox" id="toggleFilter" checked onchange="app.refreshViews()"><span class="pdot"></span><span id="filterLabelText">Filtered</span></label>
      <button class="theme-btn" id="themeToggle" onclick="app.toggleTheme()" title="Toggle theme">‚òÄ</button>
    </div>
  </div>
</header>
<main>
  <div id="globalStatus" class="alert info">Initializing‚Ä¶</div>
  <div class="hero s1" id="heroBanner" style="display:none;">
    <div class="hc ta"><div class="hl">Presidential Approval</div><div class="hr"><span class="hn" id="hlApprove" style="color:var(--app)">‚Äî</span><span class="hvs">‚Äì</span><span class="hn" id="hlDisapprove" style="color:var(--dis)">‚Äî</span><span class="hb" id="hlApprovalNet">‚Äî</span></div><div class="hm"><span id="hlApprovalTrend"></span><span id="hlApprovalPolls"></span><span id="hlApprovalWindow"></span></div><canvas class="hsp" id="sparkApproval"></canvas></div>
    <div class="hc tg"><div class="hl">Generic Congressional Ballot</div><div class="hr"><span class="hn" id="hlDem" style="color:var(--dem)">‚Äî</span><span class="hvs">‚Äì</span><span class="hn" id="hlRep" style="color:var(--rep)">‚Äî</span><span class="hb" id="hlGBNet">‚Äî</span></div><div class="hm"><span id="hlGBTrend"></span><span id="hlGBPolls"></span><span id="hlGBWindow"></span></div><canvas class="hsp" id="sparkGB"></canvas></div>
  </div>

  <div class="cd s2">
    <div class="ch"><div><div class="ct">Presidential Approval</div><div class="cs">Approve vs Disapprove ‚Äî rolling average with individual polls</div></div>
      <div class="ca"><div class="ts" data-target="approval"><button class="tb" data-days="30">30d</button><button class="tb" data-days="90">90d</button><button class="tb" data-days="180">6m</button><button class="tb" data-days="365">1y</button><button class="tb on" data-days="0">All</button></div><button class="btn" onclick="app.toggleCustomize('approval')">‚öô Customize</button></div></div>
    <div class="sg" id="approvalStats"><div class="sc"><div class="sl">Approve Avg</div><div class="sv">‚Äî</div></div><div class="sc"><div class="sl">Disapprove Avg</div><div class="sv">‚Äî</div></div><div class="sc"><div class="sl">Net Approval</div><div class="sv" id="netApprovalVal">‚Äî</div></div><div class="sc"><div class="sl">Total Polls</div><div class="sv">‚Äî</div></div></div>
    <div id="approvalCfgPanel" class="cp" style="display:none;"><div class="cg">
      <div class="ci"><div class="cl">Moving avg window (days)</div><div class="cr"><input id="approvalMADaysRange" type="range" min="3" max="120" step="1" value="14"><input id="approvalMADays" type="number" min="3" max="365" step="1" value="14"></div></div>
      <div class="ci"><div class="cl">Auto min polls</div><div class="cr"><label class="cc"><input type="checkbox" id="approvalAutoMin"><span>Enable</span></label><span class="sm">Min:</span><input id="approvalMinPolls" type="number" min="3" max="60" step="1" value="12"></div></div>
      <div class="ci"><div class="cl">Compare</div><div class="cr" style="flex-direction:column;align-items:flex-start;gap:.4rem"><label class="cc"><input type="checkbox" id="approvalCompare"><span>Filtered + All</span></label><label class="cc"><input type="checkbox" id="approvalShowDiff"><span>Difference</span></label></div></div>
    </div></div>
    <div id="approvalChart" class="pw"></div><div id="approvalDiffChart" class="pw dc"></div>
    <div class="cf">Includes "Strongly" variations. Hover dots for individual poll details.</div>
  </div>

  <div class="cd s3">
    <div class="ch"><div><div class="ct">Generic Congressional Ballot</div><div class="cs">Democrat vs Republican ‚Äî rolling average with individual polls</div></div>
      <div class="ca"><div class="ts" data-target="gb"><button class="tb" data-days="30">30d</button><button class="tb" data-days="90">90d</button><button class="tb" data-days="180">6m</button><button class="tb" data-days="365">1y</button><button class="tb on" data-days="0">All</button></div><button class="btn" onclick="app.toggleCustomize('gb')">‚öô Customize</button></div></div>
    <div class="sg" id="gbStats"><div class="sc"><div class="sl">Democratic Avg</div><div class="sv">‚Äî</div></div><div class="sc"><div class="sl">Republican Avg</div><div class="sv">‚Äî</div></div><div class="sc"><div class="sl">Margin</div><div class="sv" id="gbMarginVal">‚Äî</div></div><div class="sc"><div class="sl">Total Polls</div><div class="sv">‚Äî</div></div></div>
    <div id="gbCfgPanel" class="cp" style="display:none;"><div class="cg">
      <div class="ci"><div class="cl">Moving avg window (days)</div><div class="cr"><input id="gbMADaysRange" type="range" min="3" max="180" step="1" value="30"><input id="gbMADays" type="number" min="3" max="365" step="1" value="30"></div></div>
      <div class="ci"><div class="cl">Auto min polls</div><div class="cr"><label class="cc"><input type="checkbox" id="gbAutoMin"><span>Enable</span></label><span class="sm">Min:</span><input id="gbMinPolls" type="number" min="3" max="60" step="1" value="12"></div></div>
      <div class="ci"><div class="cl">Compare</div><div class="cr" style="flex-direction:column;align-items:flex-start;gap:.4rem"><label class="cc"><input type="checkbox" id="gbCompare"><span>Filtered + All</span></label><label class="cc"><input type="checkbox" id="gbShowDiff"><span>Difference</span></label></div></div>
    </div></div>
    <div id="gbChart" class="pw"></div><div id="gbDiffChart" class="pw dc"></div>
    <div class="cf">Hover dots for individual poll details. Spike lines track time axis.</div>
  </div>

  <div class="cd s4"><div class="ch"><div><div class="ct">Recent Polls</div><div class="cs">Latest individual poll results</div></div></div><div class="fg" id="feedGrid"></div></div>

  <div class="cd s5"><div class="ch"><div><div class="ct">Pollster Analytics</div><div class="cs">Source breakdown with counts and partisan lean</div></div><span class="mc on" id="filterModeBadge"><span id="filterModeText">Strict Allowlist</span></span></div><div class="ptw" id="pollsterTableWrap"></div></div>

  <div class="cd" id="debugCard"><div class="ch"><div class="ct">Debug</div></div><pre id="debugOut"></pre></div>
</main>
<footer class="ft"><div class="br">VoteHub</div><p>¬© <span id="year"></span> ¬∑ Data aggregated daily from public polling sources.</p><p style="margin-top:.3rem;opacity:.65">Polls are snapshots in time. Averages may lag behind events.</p></footer>

<script>
const CONFIG={approvalWindow:14,gbWindow:30,debug:new URLSearchParams(location.search).has("debug")};
const CUSTOM={approval:{maDays:14,autoMin:false,minPolls:12,compare:false,showDiff:false},gb:{maDays:30,autoMin:false,minPolls:12,compare:false,showDiff:false}};
const TR={approval:0,gb:0};
document.getElementById("year").textContent=new Date().getFullYear();

/* BG */
(function(){const c=document.getElementById('bgCanvas'),x=c.getContext('2d');let w,h,dots=[];function rs(){w=c.width=innerWidth;h=c.height=innerHeight}function mk(){dots=[];const n=Math.floor(w*h/20000);for(let i=0;i<n;i++)dots.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.5+.5,vx:(Math.random()-.5)*.12,vy:(Math.random()-.5)*.12,o:Math.random()*.25+.04})}function dr(){x.clearRect(0,0,w,h);const dk=document.documentElement.getAttribute('data-theme')==='dark';const b=dk?'255,255,255':'0,0,0';dots.forEach(d=>{d.x+=d.vx;d.y+=d.vy;if(d.x<0)d.x=w;if(d.x>w)d.x=0;if(d.y<0)d.y=h;if(d.y>h)d.y=0;x.beginPath();x.arc(d.x,d.y,d.r,0,Math.PI*2);x.fillStyle=`rgba(${b},${d.o})`;x.fill()});requestAnimationFrame(dr)}rs();mk();dr();addEventListener('resize',()=>{rs();mk()})})();

const header=document.getElementById('siteHeader');
addEventListener('scroll',()=>{header.classList.toggle('scrolled',scrollY>6)},{passive:true});

const STATE={approvalData:[],gbData:[],isDemoMode:false,filterStrict:true};
const AP=[{label:"YouGov",pattern:/yougov/},{label:"Verasight",pattern:/verasight/},{label:"Ipsos",pattern:/ipsos/},{label:"ARG",pattern:/americanresearchgroup|arg\b/},{label:"TIPP",pattern:/tipp/},{label:"Emerson",pattern:/emerson/},{label:"Gallup",pattern:/gallup/},{label:"Marist",pattern:/marist/},{label:"Quinnipiac",pattern:/quinnipiac/},{label:"AP-NORC",pattern:/apnorc|ap\-norc|norc/},{label:"Marquette",pattern:/marquette/},{label:"CNN/SSRS",pattern:/cnnssrs|cnn\/ssrs|ssrs/},{label:"AtlasIntel",pattern:/atlasintel|atlas/},{label:"Beacon/Shaw",pattern:/beaconresearch|shaw/},{label:"Hart/POS",pattern:/hartresearch|publicopinionstrategies/},{label:"Pew",pattern:/pewresearch|pew/},{label:"SurveyMonkey",pattern:/surveymonkey/},{label:"Leger",pattern:/leger/},{label:"UMass",pattern:/massachusetts|umass|departmentofpoliticalscience/},{label:"NYT/Siena",pattern:/siena|newyorktimes/},{label:"Fox News",pattern:/foxnews/},{label:"WSJ",pattern:/wallstreetjournal|wsj/}];

const $=id=>document.getElementById(id);
function log(m){if(CONFIG.debug){$('debugCard').style.display='block';$('debugOut').textContent+=`[${new Date().toISOString().slice(11,19)}] ${m}\n`}}
function showStatus(m,t='info'){const e=$('globalStatus');e.textContent=m;e.className=`alert ${t}`;e.style.display='block';if(t==='success')setTimeout(()=>e.style.display='none',4000)}
function norm(s){return String(s||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g,"")}
function isAllowed(p,strict=STATE.filterStrict){if(!strict)return true;const n=norm(p);return AP.some(x=>x.pattern.test(n))}
function parseDate(s){return new Date(`${s}T00:00:00Z`)}
function ds(d){return d.toISOString().slice(0,10)}

function calcMA(pts,wd){if(!pts.length)return[];const s=pts.slice().sort((a,b)=>a.date-b.date),ms=86400000,t=s.map(p=>p.date.getTime()),pf=[0];for(let i=0;i<s.length;i++)pf.push(pf[pf.length-1]+s[i].value);const o=[];let idx=0,left=0;for(let d=t[0];d<=t[t.length-1];d+=ms){while(idx<t.length&&t[idx]<=d)idx++;const ws=d-(wd*ms);while(left<idx&&t[left]<=ws)left++;const c=idx-left;if(c>0)o.push({date:new Date(d),value:(pf[idx]-pf[left])/c,count:c,windowDays:wd})}return o}
function calcMAMP(pts,mp){if(!pts.length)return[];const s=pts.slice().sort((a,b)=>a.date-b.date),ms=86400000,t=s.map(p=>p.date.getTime()),pf=[0];for(let i=0;i<s.length;i++)pf.push(pf[pf.length-1]+s[i].value);const o=[];let idx=0;for(let d=t[0];d<=t[t.length-1];d+=ms){while(idx<t.length&&t[idx]<=d)idx++;if(!idx)continue;let si=Math.max(0,idx-Math.max(1,mp));const st=t[si];while(si>0&&t[si-1]===st)si--;const c=idx-si,sum=pf[idx]-pf[si],wd=Math.max(0,Math.round((d-st)/ms));o.push({date:new Date(d),value:sum/c,count:c,windowDays:wd})}return o}
function diffs(a,b){const m=new Map(b.map(p=>[ds(p.date),p]));return a.filter(p=>m.has(ds(p.date))).map(p=>{const q=m.get(ds(p.date));return{date:p.date,value:p.value-q.value,countA:p.count,countB:q.count}})}
function getAns(poll,keys){if(!poll.answers)return null;for(const a of poll.answers){const c=norm(a.choice);if(c.includes('disapprove')&&keys.some(k=>norm(k).includes('approve')&&!norm(k).includes('dis')))continue;for(const k of keys)if(c.includes(norm(k)))return parseFloat(a.pct)}return null}
function ti(s){if(s.length<2)return{d:0,c:'flat',a:'‚Üí'};const cur=s[s.length-1].value,past=s[Math.max(0,s.length-8)].value,d=cur-past;if(d>.5)return{d,c:'up',a:'‚Üë'};if(d<-.5)return{d,c:'down',a:'‚Üì'};return{d,c:'flat',a:'‚Üí'}}
function ttH(s){const t=ti(s);return`<span class="tt ${t.c}">${t.a} ${Math.abs(t.d).toFixed(1)}</span>`}
function mbH(s){const t=ti(s);return`<span class="mb ${t.c}">${t.a} ${Math.abs(t.d).toFixed(1)}</span>`}
function mockData(type){const d=[],ps=AP.map(p=>p.label).concat(["Unknown","Generic"]);const now=new Date();let v=type==='approval'?42:2;for(let i=365;i>=0;i--){const dt=new Date(now.getTime()-i*86400000);v+=(Math.random()-.5)*1.5;for(let j=0;j<Math.floor(Math.random()*2.5);j++){const vr=(Math.random()-.5)*6,pv=v+vr,p=ps[Math.floor(Math.random()*ps.length)];let e={date:dt,pollster:p,sample_size:500+Math.floor(Math.random()*1000)};if(type==='approval'){e.approve=pv;e.disapprove=100-pv-5}else{e.dem=46+pv/2;e.rep=46-pv/2}d.push(e)}}return d}

function drawSpark(cid,s1,c1,s2,c2){const cv=$(cid);if(!cv||!s1.length)return;const ctx=cv.getContext('2d'),r=cv.parentElement.getBoundingClientRect(),dpr=devicePixelRatio||1;cv.width=r.width*dpr;cv.height=48*dpr;cv.style.width=r.width+'px';cv.style.height='48px';ctx.scale(dpr,dpr);const W=r.width,H=48,all=[...s1,...s2].map(p=>p.value),mn=Math.min(...all)-1,mx=Math.max(...all)+1,rn=mx-mn||1;function dl(s,c){if(!s.length)return;const st=W/(s.length-1||1);ctx.beginPath();s.forEach((p,i)=>{const x=i*st,y=H-((p.value-mn)/rn)*H;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.strokeStyle=c;ctx.lineWidth=1.5;ctx.stroke();ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.closePath();ctx.fillStyle=c.replace(')',',0.08)').replace('rgb','rgba');ctx.fill()}ctx.clearRect(0,0,W,H);dl(s2,c2);dl(s1,c1)}

function gT(){const dk=document.documentElement.getAttribute('data-theme')==='dark';return{dk,g:dk?'rgba(255,255,255,.03)':'rgba(0,0,0,.035)',t:dk?'#666':'#aaa',sp:dk?'#333':'#ddd',hb:dk?'#1a1a1e':'#fff',hbr:dk?'#333':'#e0e0e0',ht:dk?'#ddd':'#333'}}
function ftr(d,days){if(!days)return d;const c=new Date(Date.now()-days*864e5);return d.filter(p=>p.date>=c)}
const YRANGES={approval:[35,65],gb:[30,55]};
function rdc(id,dss,rk){const tr=[],th=gT(),rd=TR[rk]||0,yr=YRANGES[rk];dss.forEach(d=>{const raw=rd?ftr(d.raw||[],rd):(d.raw||[]),ma=rd?ftr(d.ma||[],rd):(d.ma||[]);if(raw.length)tr.push({x:raw.map(p=>p.date),y:raw.map(p=>p.value),mode:'markers',type:'scatter',name:d.name+' (Polls)',marker:{color:d.color,opacity:d.rawOpacity??.22,size:5,line:{width:0}},text:raw.map(p=>`<b>${p.pollster}</b><br>${ds(p.date)}<br>${d.name}: ${p.value.toFixed(1)}%<br>N=${p.sample_size}`),hovertemplate:'%{text}<extra></extra>',showlegend:false});if(ma.length)tr.push({x:ma.map(p=>p.date),y:ma.map(p=>p.value),mode:'lines',name:d.name,line:{color:d.color,width:d.lineWidth||3,dash:d.lineDash||'solid',shape:'spline',smoothing:1.3},customdata:ma.map(p=>[p.count??null,p.windowDays??null]),hovertemplate:`<b>${d.name}</b><br>%{x|%b %d, %Y}<br>%{y:.1f}%<br>Polls: %{customdata[0]}<br>Window: %{customdata[1]}d<extra></extra>`})});Plotly.react(id,tr,{autosize:true,margin:{t:12,r:14,l:42,b:40},paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{family:'DM Sans',color:th.t,size:11},xaxis:{gridcolor:th.g,zerolinecolor:th.g,tickformat:'%b %Y',showspikes:true,spikemode:'across',spikethickness:1,spikecolor:th.sp,spikedash:'solid',spikesnap:'cursor',tickfont:{family:'DM Sans',size:10}},yaxis:{gridcolor:th.g,zeroline:false,tickfont:{family:'JetBrains Mono',size:10},ticksuffix:'%',range:yr},showlegend:true,legend:{orientation:'h',y:1.08,x:0,font:{size:10}},hovermode:'closest',dragmode:'pan',hoverlabel:{bgcolor:th.hb,bordercolor:th.hbr,font:{family:'DM Sans',size:11,color:th.ht}}},{responsive:true,displayModeBar:false,scrollZoom:false})}
function rdfc(id,sl){const th=gT();Plotly.react(id,sl.map(s=>({x:(s.series||[]).map(p=>p.date),y:(s.series||[]).map(p=>p.value),mode:'lines',name:s.name,line:{color:s.color,width:2,shape:'spline',smoothing:1.2},hovertemplate:`<b>${s.name}</b><br>%{x|%b %d}<br>Œî: %{y:.2f}pp<extra></extra>`})),{autosize:true,margin:{t:8,r:14,l:42,b:32},paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{family:'DM Sans',color:th.t,size:11},xaxis:{gridcolor:th.g,zerolinecolor:th.g,tickformat:'%b %Y',showspikes:true,spikemode:'across',spikethickness:1,spikecolor:th.sp},yaxis:{gridcolor:th.g,zeroline:true,zerolinecolor:th.g,tickfont:{family:'JetBrains Mono',size:10}},showlegend:true,legend:{orientation:'h',y:1.12,x:0,font:{size:10}},hovermode:'closest',dragmode:'pan'},{responsive:true,displayModeBar:false,scrollZoom:false})}

function uS(id,cnt,s1,s2){const c=$(id);if(!c)return;const b1=c.children[0].children[1],b2=c.children[1].children[1],b3=c.children[2].children[1],b4=c.children[3].children[1];const l1=s1.length?s1[s1.length-1].value:null,l2=s2.length?s2[s2.length-1].value:null;if(l1!==null){b1.innerHTML=`${l1.toFixed(1)}% ${ttH(s1)}`;b1.style.color=id==='gbStats'?'var(--dem)':'var(--app)'}else b1.textContent='‚Äî';if(l2!==null){b2.innerHTML=`${l2.toFixed(1)}% ${ttH(s2)}`;b2.style.color='var(--rep)'}else b2.textContent='‚Äî';if(l1!==null&&l2!==null){const n=l1-l2,sg=n>0?'+':'';if(id==='gbStats'){const lb=n>0?'D':n<0?'R':'';b3.innerHTML=`<span style="color:${n>=0?'var(--dem)':'var(--rep)'}">${lb}${sg}${n.toFixed(1)}</span>`}else b3.innerHTML=`<span style="color:${n>=0?'var(--app)':'var(--rep)'}">${sg}${n.toFixed(1)}</span>`}else b3.textContent='‚Äî';b4.textContent=cnt.toLocaleString()}

function uH(apP,gbP){const bn=$('heroBanner');const mv=(a,k)=>a.map(p=>({...p,value:p[k]})).filter(p=>p.value!=null);const mf=(w,r)=>{const c=CUSTOM[w];return c.autoMin?calcMAMP(r,c.minPolls):calcMA(r,c.maDays)};const st=getComputedStyle(document.documentElement);const aR=mv(apP,'approve'),dR=mv(apP,'disapprove'),aM=mf('approval',aR),dM=mf('approval',dR);const lA=aM.length?aM[aM.length-1].value:null,lD=dM.length?dM[dM.length-1].value:null;if(lA!==null)$('hlApprove').textContent=lA.toFixed(1)+'%';if(lD!==null)$('hlDisapprove').textContent=lD.toFixed(1)+'%';if(lA!==null&&lD!==null){const n=lA-lD,s=n>0?'+':'',el=$('hlApprovalNet');el.textContent=`Net ${s}${n.toFixed(1)}`;el.style.color=n>=0?'var(--app)':'var(--dis)';el.style.background=n>=0?'var(--apps)':'var(--diss)'}$('hlApprovalTrend').innerHTML=mbH(aM);$('hlApprovalPolls').textContent=`${apP.length.toLocaleString()} polls`;if(aM.length)$('hlApprovalWindow').textContent=`${aM[aM.length-1].windowDays||CUSTOM.approval.maDays}d window`;drawSpark('sparkApproval',aM.slice(-60),st.getPropertyValue('--app').trim(),dM.slice(-60),st.getPropertyValue('--dis').trim());const deR=mv(gbP,'dem'),reR=mv(gbP,'rep'),deM=mf('gb',deR),reM=mf('gb',reR);const lDe=deM.length?deM[deM.length-1].value:null,lRe=reM.length?reM[reM.length-1].value:null;if(lDe!==null)$('hlDem').textContent=lDe.toFixed(1)+'%';if(lRe!==null)$('hlRep').textContent=lRe.toFixed(1)+'%';if(lDe!==null&&lRe!==null){const m=lDe-lRe,lb=m>0?'D':m<0?'R':'',s=m>0?'+':'',el=$('hlGBNet');el.textContent=`${lb}${s}${m.toFixed(1)}`;el.style.color=m>=0?'var(--dem)':'var(--rep)';el.style.background=m>=0?'var(--dems)':'var(--reps)'}$('hlGBTrend').innerHTML=mbH(deM);$('hlGBPolls').textContent=`${gbP.length.toLocaleString()} polls`;if(deM.length)$('hlGBWindow').textContent=`${deM[deM.length-1].windowDays||CUSTOM.gb.maDays}d window`;drawSpark('sparkGB',deM.slice(-60),st.getPropertyValue('--dem').trim(),reM.slice(-60),st.getPropertyValue('--rep').trim());bn.style.display='grid'}

function uF(apP,gbP){const g=$('feedGrid');const rA=apP.slice().sort((a,b)=>b.date-a.date).slice(0,12);const rG=gbP.slice().sort((a,b)=>b.date-a.date).slice(0,12);let h='<div class="fs"><h3><span class="dt" style="background:var(--app)"></span> Approval</h3><div class="fl">';rA.forEach(p=>{const a=p.approve!=null?p.approve.toFixed(1):'‚Äî',d=p.disapprove!=null?p.disapprove.toFixed(1):'‚Äî';h+=`<div class="fi"><span class="fp">${p.pollster}</span><span class="fd">${ds(p.date)}</span><span class="fv"><span style="color:var(--app)">${a}</span><span style="color:var(--dis)">${d}</span></span></div>`});if(!rA.length)h+='<div class="sm" style="padding:1rem">No data.</div>';h+='</div></div><div class="fs"><h3><span class="dt" style="background:var(--dem)"></span> Generic Ballot</h3><div class="fl">';rG.forEach(p=>{h+=`<div class="fi"><span class="fp">${p.pollster}</span><span class="fd">${ds(p.date)}</span><span class="fv"><span style="color:var(--dem)">${p.dem.toFixed(1)}</span><span style="color:var(--rep)">${p.rep.toFixed(1)}</span></span></div>`});if(!rG.length)h+='<div class="sm" style="padding:1rem">No data.</div>';h+='</div></div>';g.innerHTML=h}

function uPT(gbP,apP){const w=$('pollsterTableWrap');const ps={};gbP.forEach(p=>{const n=p.pollster||'Unknown';if(!ps[n])ps[n]={c:0,ds:0,rs:0,ss:0,sc:0,tr:isAllowed(n,true)};ps[n].c++;ps[n].ds+=p.dem;ps[n].rs+=p.rep;if(p.sample_size){ps[n].ss+=p.sample_size;ps[n].sc++}});apP.forEach(p=>{const n=p.pollster||'Unknown';if(!ps[n])ps[n]={c:0,ds:0,rs:0,ss:0,sc:0,tr:isAllowed(n,true)};ps[n].c++;if(p.sample_size){ps[n].ss+=p.sample_size;ps[n].sc++}});const sorted=Object.entries(ps).sort((a,b)=>b[1].c-a[1].c).slice(0,25);let h='<table class="pt"><thead><tr><th>Pollster</th><th>Polls</th><th>Avg N</th><th>GB Lean</th><th>Status</th></tr></thead><tbody>';sorted.forEach(([n,s])=>{const avg=s.sc?Math.round(s.ss/s.sc).toLocaleString():'‚Äî';let lean='‚Äî';if(s.ds>0&&s.rs>0){const l=(s.ds-s.rs)/s.c,lb=l>0?'D':l<0?'R':'',sg=l>0?'+':'',cl=l>=0?'var(--dem)':'var(--rep)',wd=Math.min(60,Math.abs(l)*4);lean=`<span class="lb" style="background:${cl};width:${wd}px;margin-right:6px"></span><span class="mn" style="color:${cl}">${lb}${sg}${l.toFixed(1)}</span>`}const badge=s.tr?'<span style="color:var(--app);font-size:.7rem">‚úì Trusted</span>':'<span style="color:var(--t3);font-size:.7rem">‚Äî</span>';h+=`<tr><td style="font-weight:600">${n}</td><td><span class="bc">${s.c}</span></td><td class="mn">${avg}</td><td>${lean}</td><td>${badge}</td></tr>`});h+='</tbody></table>';if(!sorted.length)h='<div class="sm" style="padding:1rem">No data.</div>';w.innerHTML=h}

document.querySelectorAll('.ts').forEach(sel=>{sel.querySelectorAll('.tb').forEach(btn=>{btn.addEventListener('click',()=>{sel.querySelectorAll('.tb').forEach(b=>b.classList.remove('on'));btn.classList.add('on');TR[sel.dataset.target]=parseInt(btn.dataset.days)||0;app.refreshViews()})})});

const app={
  async init(){$('loadingIndicator').style.display='block';if(matchMedia('(prefers-color-scheme:dark)').matches){document.documentElement.setAttribute('data-theme','dark');$('themeToggle').textContent='‚òæ'}
    try{const cands=[new URL('polls.json',location.href).href,'./polls.json','polls.json','../polls.json'];let res=null,le=null;for(const u of cands){try{const r=await fetch(u,{cache:'no-store'});if(r&&r.ok){res=r;break}}catch(e){le=e}}if(!res)throw(le||new Error('No polls.json'));const j=await res.json();const gl=j.genericBallot||j.polls||[],al=j.approval||[];if(!gl.length&&!al.length)throw new Error("Empty");STATE.gbData=this.nGB(gl);STATE.approvalData=this.nAP(al);if(j.updatedAt||j.updated_at)showStatus(`Updated: ${new Date(j.updatedAt||j.updated_at).toLocaleString()}`,"success");else showStatus("Loaded.","success")}catch(e){console.warn("Demo",e);STATE.isDemoMode=true;showStatus("No polls.json ‚Äî demo data.","warn");STATE.gbData=mockData('gb');STATE.approvalData=mockData('approval')}
    $('loadingIndicator').style.display='none';this.initCC();this.refreshViews();addEventListener('resize',()=>{['gbChart','approvalChart','gbDiffChart','approvalDiffChart'].forEach(id=>{try{if($(id))Plotly.Plots.resize(id)}catch(e){}})});matchMedia('(prefers-color-scheme:dark)').addEventListener('change',e=>{document.documentElement.setAttribute('data-theme',e.matches?'dark':'light');$('themeToggle').textContent=e.matches?'‚òæ':'‚òÄ';this.refreshViews()})},
  toggleTheme(){const c=document.documentElement.getAttribute('data-theme'),n=c==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',n);$('themeToggle').textContent=n==='dark'?'‚òæ':'‚òÄ';this.refreshViews()},
  toggleCustomize(w){const p=$(w+'CfgPanel');if(p)p.style.display=p.style.display==='none'?'block':'none'},
  initCC(){const setup=(w,def)=>{const d=$(w+'MADays'),dR=$(w+'MADaysRange'),au=$(w+'AutoMin'),mp=$(w+'MinPolls'),cm=$(w+'Compare'),sd=$(w+'ShowDiff');if(!d||!dR||!au||!mp||!cm||!sd)return;CUSTOM[w].maDays=def.maDays;CUSTOM[w].autoMin=def.autoMin;CUSTOM[w].minPolls=def.minPolls;CUSTOM[w].compare=def.compare;CUSTOM[w].showDiff=def.showDiff;d.value=CUSTOM[w].maDays;dR.value=Math.min(parseInt(dR.max||'365'),CUSTOM[w].maDays);au.checked=CUSTOM[w].autoMin;mp.value=CUSTOM[w].minPolls;cm.checked=CUSTOM[w].compare;sd.checked=CUSTOM[w].showDiff;const sync=()=>{d.disabled=au.checked;dR.disabled=au.checked;mp.disabled=!au.checked;sd.disabled=!cm.checked;if(!cm.checked)sd.checked=false;CUSTOM[w].autoMin=au.checked;CUSTOM[w].minPolls=parseInt(mp.value||def.minPolls);CUSTOM[w].compare=cm.checked;CUSTOM[w].showDiff=sd.checked;CUSTOM[w].maDays=parseInt(d.value||def.maDays)};const go=()=>{d.value=Math.max(3,parseInt(d.value||def.maDays));dR.value=Math.min(parseInt(dR.max||'365'),parseInt(d.value));mp.value=Math.max(3,parseInt(mp.value||def.minPolls));sync();app.refreshViews()};dR.addEventListener('input',()=>{d.value=dR.value;go()});d.addEventListener('change',go);au.addEventListener('change',go);mp.addEventListener('change',go);cm.addEventListener('change',go);sd.addEventListener('change',go);sync()};setup('approval',{maDays:CONFIG.approvalWindow,autoMin:true,minPolls:24,compare:false,showDiff:false});setup('gb',{maDays:CONFIG.gbWindow,autoMin:true,minPolls:24,compare:false,showDiff:false})},
  nGB(l){return l.map(p=>{const d=getAns(p,['Dem','Democrat']),r=getAns(p,['Rep','Republican']);if(d===null||r===null)return null;return{date:parseDate(p.end_date||p.start_date),dem:d,rep:r,pollster:p.pollster,sample_size:p.sample_size}}).filter(x=>x)},
  nAP(l){return l.map(p=>{const a=getAns(p,['Approve','Strongly Approve','Yes']),d=getAns(p,['Disapprove','Strongly Disapprove','No']);if(a===null&&d===null)return null;return{date:parseDate(p.end_date||p.start_date),approve:a,disapprove:d,pollster:p.pollster,sample_size:p.sample_size}}).filter(x=>x)},
  refreshViews(){STATE.filterStrict=$('toggleFilter').checked;const bd=$('filterModeBadge'),mt=$('filterModeText'),fl=$('filterLabelText');if(STATE.filterStrict){mt.textContent="Strict Allowlist";bd.className="mc on";fl.textContent="Filtered"}else{mt.textContent="All Sources";bd.className="mc off";fl.textContent="All"}
    const gbS=STATE.gbData.filter(p=>isAllowed(p.pollster,true)),gbA=STATE.gbData.slice(),apS=STATE.approvalData.filter(p=>isAllowed(p.pollster,true)),apA=STATE.approvalData.slice();
    const gbP=STATE.filterStrict?gbS:gbA,apP=STATE.filterStrict?apS:apA;
    const mv=(a,k)=>a.map(p=>({...p,value:p[k]})).filter(p=>p.value!=null);
    const mf=(w,r)=>{const c=CUSTOM[w];return c.autoMin?calcMAMP(r,c.minPolls):calcMA(r,c.maDays)};
    const cs=getComputedStyle(document.documentElement);const dC=cs.getPropertyValue('--dem').trim(),rC=cs.getPropertyValue('--rep').trim(),aC=cs.getPropertyValue('--app').trim(),diC=cs.getPropertyValue('--dis').trim();
    uH(apP,gbP);uF(apP,gbP);uPT(gbP,apP);
    {const cfg=CUSTOM.approval,aR=mv(apP,'approve'),dR=mv(apP,'disapprove'),aM=mf('approval',aR),dM=mf('approval',dR);uS('approvalStats',apP.length,aM,dM);let d2=[{name:'Approve',raw:aR,ma:aM,color:aC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Disapprove',raw:dR,ma:dM,color:diC,rawOpacity:.2,windowDays:cfg.maDays}];const df=$('approvalDiffChart');if(cfg.compare){const aRF=mv(apS,'approve'),dRF=mv(apS,'disapprove'),aMF=mf('approval',aRF),dMF=mf('approval',dRF),aRA=mv(apA,'approve'),dRA=mv(apA,'disapprove'),aMA=mf('approval',aRA),dMA=mf('approval',dRA);d2=[{name:'Approve (Filtered)',raw:aRF,ma:aMF,color:aC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Disapprove (Filtered)',raw:dRF,ma:dMF,color:diC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Approve (All)',raw:aRA,ma:aMA,color:aC,lineDash:'dot',rawOpacity:.1,lineWidth:2,windowDays:cfg.maDays},{name:'Disapprove (All)',raw:dRA,ma:dMA,color:diC,lineDash:'dot',rawOpacity:.1,lineWidth:2,windowDays:cfg.maDays}];if(cfg.showDiff){df.style.display='block';rdfc('approvalDiffChart',[{name:'Approve Œî',color:aC,series:diffs(aMF,aMA)},{name:'Disapprove Œî',color:diC,series:diffs(dMF,dMA)}])}else df.style.display='none'}else df.style.display='none';rdc('approvalChart',d2,'approval')}
    {const cfg=CUSTOM.gb,dR=mv(gbP,'dem'),rR=mv(gbP,'rep'),dM=mf('gb',dR),rM=mf('gb',rR);uS('gbStats',gbP.length,dM,rM);let d2=[{name:'Democrats',raw:dR,ma:dM,color:dC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Republicans',raw:rR,ma:rM,color:rC,rawOpacity:.2,windowDays:cfg.maDays}];const df=$('gbDiffChart');if(cfg.compare){const dRF=mv(gbS,'dem'),rRF=mv(gbS,'rep'),dMF=mf('gb',dRF),rMF=mf('gb',rRF),dRA=mv(gbA,'dem'),rRA=mv(gbA,'rep'),dMA=mf('gb',dRA),rMA=mf('gb',rRA);d2=[{name:'Dem (Filtered)',raw:dRF,ma:dMF,color:dC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Rep (Filtered)',raw:rRF,ma:rMF,color:rC,rawOpacity:.2,windowDays:cfg.maDays},{name:'Dem (All)',raw:dRA,ma:dMA,color:dC,lineDash:'dot',rawOpacity:.1,lineWidth:2,windowDays:cfg.maDays},{name:'Rep (All)',raw:rRA,ma:rMA,color:rC,lineDash:'dot',rawOpacity:.1,lineWidth:2,windowDays:cfg.maDays}];if(cfg.showDiff){df.style.display='block';rdfc('gbDiffChart',[{name:'Dem Œî',color:dC,series:diffs(dMF,dMA)},{name:'Rep Œî',color:rC,series:diffs(rMF,rMA)}])}else df.style.display='none'}else df.style.display='none';rdc('gbChart',d2,'gb')}}
};
if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',()=>app.init());else app.init();
</script>
</body>
</html>
